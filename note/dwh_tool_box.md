#数据仓库工具箱阅读笔记  
##第一章  
####数据仓库需求  
######1.数据仓库能够方便的存取信息 -- 数据直观易于理解  
######2.数据的展示形式必须是一致的 -- 指标名称定义必须一致  
######3.数据仓库设计必须能够适应变化  
######4.数据必须能够及时的展现  
######5.数据安全保障  
######6.数据可信度高  
######7.数据能够被业务认可  

####关系型数据库三范式  
######1.字段原子性 不可再分  
######2.每一个字段都与主键相关,数据是最细的粒度  
######3.数据不能够冗余  

####什么是维度建模  
维度建模是用于数据分析和数据仓库的建模方法  
主要是由维度表和事实表组成(为了提高查询效率增加了数据冗余,反范式技术)  
优点:便于理解,提高查询性能,对称性,可拓展性  
原则:同一个事实表中的行记录的粒度必须是一致的  
事实表用于存储业务过程中事件的性能度量结果(例如一个篮球场相当于一个事实表,这个篮球场中发生的一件事情就是该表中的一行记录)  
维度表用于描述环境(用于描述与谁,什么,哪里,何时,何地...有关的环境 例如从身高体重性别年龄的维度描述一个人)***维度的值必须保持一致***  

####维度建模 范式建模
######1.维度建模 模型简单 开发周期短 维护成本高 可读性高易于理解(常用于数据集市层(dm)以及dws层)
######2.范式建模 数据一致性(一份数据只能存在一个表) 方便维护 避免冗余(常用于数据明细层(ods 或者 dwd 或者ods 和dwd中间层))
######当数据量非常大时,完全规范的范式建模并不是最好的选择,因此可以增加冗余字段减少关联次数  
######雪花模型是介于范式模型和星型模型之间,雪花模型在维度表上是可能存在冗余但是范式模型维度表没有  


####Kimball 架构  
######1.操作型源系统:用于完成某项功能而存放业务数据的系统,处于数据仓库之外但是是数据的源头 如mysql 操作日志 埋点数据  
######2.ETL系统(ods,dwd,dws,dim): 数据获取是将操作型源系统中的数据复制到etl系统,数据转换采用清洗和整合的提高数据利用价值和数据质量(hql python shell java),数据加载是根据维度模型的定义将数据加载到模型中  不支持用户查询  
######3.数据展现系统(dm_report): 星型模型/LOAP多维模型  
######4.数据应用系统(dm_application): 数据分析 推荐系统 报表系统  

####数据仓库和数据集市  
######1.数据集市可以理解为数据仓库的子集只包含单个主题,是一个从操作的数据和其他的为某个特殊的专业人员团体服务的数据源中收集数据的仓库;重点在于他迎合了专业用户群体的特殊需求，其面向部门级业务或某一个特定的主题、良好解决了灵活性和性能之间的矛盾;可以划分为独立的数据集市 和非独立数据集市(数据仓库的子集)  
######数据集市特点(1)规模小(2)面向部门(3)有特定主题域(4)有业务部门开发/维护/管理(5)能快速实现(6)提供更详细的、预先存在的、数据仓库的摘要子集(7)可升级到完整的数据仓库  
######2.数据仓库:(1)面向主题(2)集成的(3)相对稳定(4)反应历史变化  
######(1)数据仓库用于支持决策,面向分析型数据处理,它不同于企业现有的操作型数据库(2)数据仓库是对多个异构的数据源有效集成,集成后按照主题进行了重组,并包含历史数据,而且存放在数据仓库中的数据一般不再修改  
######3.区别:(1)数据仓库是企业级的,能为整个企业各个部门的运行提供决策支持手段(2)数据集市则是一种微型的数据仓库,它通常有更少的数据,更少的主题区域,以及更少的历史数据,因此是部门级的,一般只能为某个局部范围内的管理人员服务,因此也称之为部门级数据仓库  

|  对比  | 数据仓库 | 数据集市 |
|  -----  | ----- | ----  |
| 数据来源  | 生产系统,外部数据等 | 数据仓库 |
| 规模范围  | 企业级别 | 部门级别或者小组 |
| 主题  | 以企业为主题 | 以部门或者特殊分析为主题 |
| 数据粒度  | 最细粒度 | 较粗粒度 |
| 数据结构  | 范式/反范式 | 星型模型 雪花模型 星座模型 |
| 历史数据  | 大量历史数据 | 适度数据 |
| 优化  | 处理海量数据 | 查询效率高 |


##第二章  
####维度建模的四大步骤  
######1.选择业务过程(主题)  
######2.声明数据粒度(同一个表中的粒度是一致的)
######3.确定维度(保证描述标识统一)
######4.确定事实(行记录与粒度保持一致)  


####缓慢变化维度(scd)
######1.维度值变化并且需要修改历史数据 -- 直接修改维度表
######2.维度值在不同时间段不一样 -- 维度表中新增记录 添加字段标识有效的时间以及当前是否有效字段
######3.维度值新增且要保留变化前后的数据 -- 维度表中添加字段 变化前和变化后(局限只保留两次)
####快速变化维度(rcd)
######1.维度表字段不多数据量 -- 添加新纪录 标识当前是否可用
######2.维度表字段较多数量较大 -- 维度表中添加字段 变化前和变化后(局限只保留两次)
######3.维度表字段多数量大 -- 将频繁变化的字段单独拿出来做新的维度表


####事实表  
######1.数字度量事实:可加(销售额) 半可加(时间维度的用户余额不可加 其他维度的可加) 不可加(某某率)
######2.事务事实表:记录所有的(增量更新 类似流水表) 2.周期快照事实表(比如每天只记录某天订单的最后状态) 3.累积快照事实表(订单的每个阶段就是一行通常有多个日期字段 拉链表)  
####维度表  


##第三章
######1.维度表的雪花模型:范式化的维度表成为雪花维度,冗余属性从维度表中提出,拆成不同范式化的维度表中  

##第三章之后都是围绕例子来讲维度建模


##为什么数据仓库要分层
######1.数据结构清晰 每一层都有它的作用域 方便使用和理解
######2.便于追踪血缘 因为仓库是整合的,一张业务表也有很多来源,分层能够让我们准确的定位问题以及了解影响范围
######3.减少重复开发 规范的分层,会产生一些中间表,能够极大减少重复计算
######4.便于维护 分层便于理解和管理,不会把很复杂的逻辑通过一段计算从头到尾计算出来,当数据出现问题的时候,只需要从出问题的地方开始修复
######5.可以屏蔽原始数据的异常值
######6.当需要修改指标定义时,不需要从底层开始改,只需要对应的层
######7.如果都是从源表直接取数据做报表,当报表相互产生依赖时,便难于管理